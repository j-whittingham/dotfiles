#!/usr/bin/env fish

headline+ "install selfoss aggregator"

install php5-cli
install php5-common
install php5-fpm
install php5-gd
install php5-sqlite
original /etc/php5/fpm/php.ini
original /etc/php5/fpm/pool.d/www.conf
sudo sed -i -e 's/^;\(date.timezone\) =.*/\1 = "Canada\/Eastern"/' \
            -e 's/\(max_execution_time\) =.*/\1 = 300/' /etc/php5/fpm/php.ini
sudo sed -i 's/^;\(request_terminate_timeout\) =.*/\1 = 300/' /etc/php5/fpm/pool.d/www.conf
sudo systemctl enable php5-fpm.service
sudo systemctl restart php5-fpm.service

cd /data/depot/rss/selfoss
git clone https://github.com/SSilence/selfoss.git
sudo chmod -Rv 777 selfoss/data
sudo chmod -Rv 777 selfoss/public
echo '<?php phpinfo(); ?>' > selfoss/info.php
sudo mv -v selfoss /srv/www/
sudo systemctl restart nginx.service
