#!/usr/bin/env fish
# these last steps used to be part of crunchbang-3install but fish cannot
# grab hold of terminal to complete

#------------------------------------
headline "manual installation tweaks"
#------------------------------------

# reinstall power manager which seems to get disabled by wheezy upgrade
#if [ (head -1 /etc/apt/apt.conf | sed 's/^.*"\(.*\)".*/\1/') = wheezy ]
#    install I xfce4-power-manager
#end
if-no "install kernel sensor modules for conky"; or sudo sensors-detect
#sudo /etc/init.d/module-init-tools start

#-------------------------
headline "udev boot fixes"
#-------------------------
~/bin/install/crunchbang-4post-upgrade

##--------------------------------
#headline "kernel microcode fixes"
##--------------------------------
#sudo apt-get -y purge intel-microcode iucode-tool microcode.ctl
#install intel-microcode

#-------------------------------------
headline "init level services removal"
#-------------------------------------

sudo update-rc.d bluetooth remove
sudo update-rc.d gdomap remove
sudo update-rc.d motd remove
sudo update-rc.d openvpn remove
sudo update-rc.d saned remove
annotate "services can be re-enabled with sysv-rc-conf or update-rc.d"

#-------------------------------
headline "complete installation"
#-------------------------------

~/bin/install/crunchbang-4post-upgrade
xscreensaver -no-splash &
if-yes "set default applications"; and sudo update-alternatives --all
if-no "set root default shell"; or ~/bin/install/crunchbang-6fishshell root
if-no "set common symlinks"; or ~/bin/install/crunchbang-7symcommon
if-no "set config symlinks"; or ~/bin/install/crunchbang-8symlinks
if-no "auto startx notion"; or begin; touch ~/.startx; x notion; end
if-no "reboot"; or sudo reboot
