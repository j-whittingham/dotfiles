#!/usr/bin/env fish
# assumes that fish is already installed along with user functions
# so a virgin install will require some user installation preparation
# notably the above, bin/install and software depot of non-deb packages
# see install-zfs to include /data/depot installs from this script

# for future install decisions based on available ram and disks instead of hostname
set gbram (cat /proc/meminfo | head -1 | awk '{printf ("%i", $2/1024/1024)}')
set numdisks (ll /dev/sd*1 | wc -l)

set distro (head -1 /etc/apt/apt.conf | sed 's/^.*"\(.*\)".*/\1/')
log ""
log ""
annotate "using debian $distro"
log ""

function new-install
    [ -d /data/depot -a -f ~/.new-install ]; and true; or false
end

killall xscreensaver
xset s off -dpms
# default log of log.fish
xfce4-terminal -x tail -f ~/tmp/session.log &

# capture log (script) of install exceptions (see install)
echo "#!/usr/bin/env fish
# crunchbang-3install exceptions
# run as: ./crunchbang-3exceptions [options ..]
# example: ./crunchbang-3exceptions -t sid

" >~/bin/install/crunchbang-3exceptions
chmod -v 755 ~/bin/install/crunchbang-3exceptions
xfce4-terminal -x tail -f ~/bin/install/crunchbang-3exceptions &


#----------------------------------------
headline "haskell"
#----------------------------------------

install cabal-install cabal-debian
install ghc ghc-doc ghc-haddock ghc-prof
install haskell-platform haskell-platform-doc haskell-platform-prof
install libghc-reactive-banana-dev
cabal update
cabal install hoogle


#----------------
headline "system"
#----------------

install arandr
install autocutsel
#install cpufrequtils

#install fish
#new-install; and ~/bin/install/install-fishfish
#original /usr/local/bin/fish
#original /usr/local/bin/fishd
#original /usr/local/bin/fish_indent
#original /usr/local/bin/fish_pager
#sudo ln -sfv /usr/local/bin/fish /usr/bin/fish
#sudo ln -sfv /usr/local/bin/fishd /usr/bin/fishd
#sudo ln -sfv /usr/local/bin/fish_indent /usr/bin/fish_indent
#sudo ln -sfv /usr/local/bin/fish_pager /usr/bin/fish_pager

install fonts-inconsolata fonts-linuxlibertine
install fortunes fortunes-off
install keepassx
install libdate-manip-perl libtime-modules-perl

install ntpdate
sudo ntpdate time.nrc.ca

install paprefs
install qshutdown
install rlwrap
#install screen
install startupmanager
install tmux


#-------------------
headline "utilities"
#-------------------

install ack-grep
sudo ln -sfv /usr/bin/ack-grep /usr/bin/ack 2>/dev/null

install filelight
install font-manager
install fontmatrix
install gprename
install guake
install locate
install lsof
#install nautilus
install ncdu
install ranger
install rox-filer avfs
mkdir ~/.avfs-mount
annotate "add $USER to ntp group in /etc/group"

install rsync
install telnet
install tree
#install unetbootin
install vifm
install xfce4-terminal
install xterm


#-------------------------
headline "version control"
#-------------------------

install bzr bzrtools
install cvs
install git git-gui git-cvs git-svn git-email
install mercurial
install patch
install subversion subversion-tools
install thunar-vcs-plugin


#---------------
headline "video"
#---------------

if [ (hostname) = luna ]
    install coriander
    install dvdbackup
    #install vloopback-source
    install ffmpeg
    install gnome-subtitles gstreamer0.10-ffmpeg
    install genisoimage growisofs
    install handbrake-cli handbrake-gtk
    install k3b
end

install minitube
original /usr/bin/minitube
#install mplayer
#etc-config /etc/mplayer/mplayer.conf
install smplayer mplayerthumbs
sudo dpkg -i /data/media/umplayer/umplayer_0.95_amd64.deb

install xbmc xbmc-skin-confluence
original /usr/bin/xbmc
sudo ln -sfv ~/bin/xbmc /usr/bin/xbmc


#-----------------
headline "viewers"
#-----------------

install calibre
install comix
install fbreader
install mupdf
install zathura


#--------------------
headline "virtualbox"
#--------------------

wget -q http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc -O- | sudo apt-key add -
#if [ (hostname) = luna ]
if [ $gbram -gt 4 ]
    install linux-headers-(uname -r)
    install dkms
    install virtualbox-4.2
    annotate "adding \"vboxdrx\" to /etc/modules"
    sudo echo >>/etc/modules; sudo echo vboxdrv >>/etc/modules
    annotate "create /usr/share/virtualbox/VBoxCreateUSBNode.sh on root filesystem"
end


#-------------
headline "web"
#-------------

#install blogilo
install curl
install cronolog
install dict
install flashplugin-nonfree
install newsbeuter
install surfraw
install ttytter
new-install; and ~/bin/install/install-turses


#------------------------------
headline "web servers and wiki"
#------------------------------

# installed for nanoki and google reader css
#install nginx
#etc-config /etc/nginx/nginx.conf
#etc-config /etc/nginx/sites-available/default
if [ -d /opt/nginx ]
    sudo cp /srv/www/init-deb.sh /etc/init.d/nginx
    sudo update-rc.d nginx defaults
end

#sudo gem install instiki
#sudo gem install gollum

#new-install; and ~/bin/install/install-nanoki
#original /etc/hosts
#grep thedarnedestthing /etc/hosts; or begin;
#    sudo echo >>/etc/hosts
#    sudo echo "127.0.0.1       thedarnedestthing" >>/etc/hosts
#end
etc-config /etc/hosts

#install sputnik
#install xavante xavante-doc


#-------------
headline "x11"
#-------------

install gtk2-engines-pixbuf
install faenza-crunchbang-icon-theme
# gtk engines for ffuu theme
new-install; and ~/bin/install/install-equinox
#new-install; and ~/bin/install/install-murrine

#install awesome awesome-extra
#install dwm
#install herbstluftwm
#install i3
install notion stalonetray
#install ratpoison
#install spectrwm
#install stumpwm
install subtle
#install wmii
#install xfce4
install xrestop

install xmonad libghc-xmonad-dev libghc-xmonad-doc xfonts-base xmobar dzen2 trayer
#cabal install taffybar
cabal install yeganesh
cabal install tagsoup

# disable display manager and enable auto login
#sudo update-rc.d -f gdm remove
#etc-config /etc/inittab

#new-install; and ~/bin/install/install-compton
new-install; and ~/bin/install/install-trayion
mkdir -pv ~/.x11/notion/default-session--0
chown -Rv $USER ~/.x11


#----------------------------
headline "untrusted packages"
#----------------------------

if [ (hostname) = luna -a ! -f /usr/sbin/start_pms ]
    install plexmediaserver
    etc-config /etc/default/plexmediaserver
    sudo mkdir -pv /srv/plexmediaserver/Library/Application\ Support 2>/dev/null
    sudo chown -v plex /srv/plexmediaserver/
    sudo chown -R plex /srv/plexmediaserver/
    sudo /etc/init.d/plexmediaserver restart
end

# the following gackages conflict with the wheezy installs if preceding
#if [ (hostname) = luna ]
#   sudo dpkg -i ~/depot/system/powerpanel_1.2_amd64.deb
#end

#if [ (hostname) = luna ]
#   sudo dpkg -i ~/depot/astronomy/google-earth-stable_current_amd64.deb
#end

#if [ (hostname) = luna ]
#   install ia32-libs-gtk
#   sudo dpkg -i ~/depot/www/google-talkplugin_current_amd64.deb
#end


#----------------------------
headline "install exceptions"
#----------------------------

annotate "logged install exceptions"
cat ~/bin/install/crunchbang-3exceptions
log ""
log "Ending crunchbang-3install ... "(date '+%Y.%m.%d %H:%S:%M')
log ""

exec ~/bin/install/crunchbang-3finish
