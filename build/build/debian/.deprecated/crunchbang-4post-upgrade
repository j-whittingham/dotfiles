#!/usr/bin/env fish
# post update checks

# udev alsa boot up fix
grep -q '/usr/sbin' /lib/udev/rules.d/90-alsa-restore.rules; and begin
  sudo cp -v /usr/sbin/alsactl /lib/udev/
  original /lib/udev/rules.d/90-alsa-restore.rules
  sudo sed -i 's,/usr/sbin,/lib/udev,g' /lib/udev/rules.d/90-alsa-restore.rules
end

# possible upgrade re-installs
function reinstall
    [ (apt s $argv | grep "^i . $argv" | wc -l) -eq 0 ]; and apt y $argv
end

reinstall conky
[ -f /usr/sbin/gdm ]; and reinstall hal
reinstall xfce4-power-manager
cmp -s ~/.config/etc/X11/xorg.conf.d/10-evdev.conf /usr/share/X11/xorg.conf.d/10-evdev.conf; or sudo cp -v ~/.config/etc/X11/xorg.conf.d/10-evdev.conf /usr/share/X11/xorg.conf.d/10-evdev.conf
sudo update-rc.d -f mpd remove

# some subsequent install customizations that may get overwritten
function replace
    if [ -f /usr/bin/$argv ]
        cmp -s ~/bin/$argv /usr/bin/$argv; or begin
            original -f /usr/bin/$argv
            sudo ln -sfv ~/bin/$argv /usr/bin/$argv
        end
    end
end

#replace luakit
#replace gnome-mplayer
#replace minitube
#replace smplayer
#replace umplayer
#replace vlc
#replace xbmc

# see crunchbang-4install
sudo rm -f ~/.new-install 2>/dev/null
