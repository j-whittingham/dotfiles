#!/bin/sh
# /etc initialization

# sudo keyboardctl --set-layout "us" "" "colemak"
# [ $(hostname) = monad ] &&  sudo sed -i 's/^# *\(numlock *\)on/\1off/' /etc/slim.conf

echo " -> setup noprompt sudo: shum ALL=(root) NOPASSWD:ALL"
echo " .. press return to continue"
read
sudo visudo

# disable systemd generated interface name in preference of kernel named e.g. wlan0
sudo ln -s /dev/null /etc/udev/rules.d/80-net-name-slot.rules

# cp -Rfv /etc/skel/.config/openbox/* /home/shum/.config/openbox/
# sudo chown -R shum:users $HOME/.config
sudo chown -R root:root /usr/local

if [ $(hostname) = monad ]; then
  sudo systemctl stop NetworkManager
  sudo systemctl stop NetworkManager-wait-online
  sudo systemctl disable NetworkManager
  sudo systemctl disable NetworkManager-wait-online
  sudo cp /etc/netctl/examples/wireless-wpa /etc/netctl/wireless-wpa
  essid=s/ESSID=.*/ESSID=$(wpa_passphrase "Ravens" "the keys of enoch" | grep ssid | sed 's/.*\(".*"\)/\1/')/
  key=s/Key=.*/Key=\\\\\"$(wpa_passphrase "Ravens" "the keys of enoch" | grep "[^#]psk" | sed 's/.*=\(.*\)/\1/')/
  sudo sed -i -e $essid -e $key /etc/netctl/wireless-wpa
  echo ":: set up wireless for remaining steps"
  sudo wifi-menu -o
  # verify connection to activate
  sudo wifi-menu -o
  sudo ping 10.1.0.1
fi
echo ".. must be root to sudo wifi-menu and sudo ping to activate connection"
