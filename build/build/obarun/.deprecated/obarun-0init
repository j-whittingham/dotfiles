#!/bin/sh
# sdothum - 2016 (c) wtfpl

# fresh obarun pre-installer

# ./obarun-00mnt
source ./obarun-functions
# checkpoint


heading 'edit fstab'
# ══════════════════════════════════════════════════════════════════════════════
mkdir -p /mnt/btrfs-boot/etc
original /mnt/btrfs-boot/etc/fstab
genfstab -L -p /mnt/btrfs-boot | tee /mnt/btrfs-boot/etc/fstab
vi /mnt/btrfs-boot/etc/fstab
checkpoint


heading 'edit syslinux.cfg'
# ══════════════════════════════════════════════════════════════════════════════
original /mnt/btrfs-boot/boot/syslinux/syslinux.cfg
sed -i '/^TIMEOUT/s/ [0-9]*/ 30/ ; /APPEND/s/sda[23].*/sda3 ro rootflags=subvol=__current\/ROOT/' /mnt/btrfs-boot/boot/syslinux/syslinux.cfg
vi /mnt/btrfs-boot/boot/syslinux/syslinux.cfg


heading 'edit s6.conf'
# ══════════════════════════════════════════════════════════════════════════════
original /mnt/btrfs-boot/etc/s6/s6.conf
sed -i '/^USEBTRFS/s/=no/=yes/ ; /^USESWAP/s/=no/=yes/' /mnt/btrfs-boot/etc/s6/s6.conf
vi /mnt/btrfs-boot/etc/s6/s6.conf

# vim: set ft=sh: #
