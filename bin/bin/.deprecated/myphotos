#!/usr/bin/env ruby
# encoding: UTF-8

require 'term/ansicolor'

class String
  include Term::ANSIColor
end

def copy_images(file, camera)
  filename = File.basename(file)
  date = File.stat(file).mtime.strftime('%Y-%m-%d')
  year = date.sub(/-\d\d-\d\d/, '')
  unless Dir.exist?("/net/media/images/#{camera}/#{year}")
    print "\n=> #{year}\n\n".red.bold
    Dir.mkdir("/net/media/images/#{camera}/#{year}")
  end
  unless Dir.exist?("/net/media/images/#{camera}/#{year}/#{date}")
    print "\n=> #{year} / #{date}\n\n".green.bold
    Dir.mkdir("/net/media/images/#{camera}/#{year}/#{date}")
  end
  print "#{filename}"
  unless File.exist?("/net/media/images/#{camera}/#{year}/#{date}/#{filename}")
    print " => #{year} / #{date} / #{filename}".yellow.bold
    File.copy_stream(file, "/net/media/images/#{camera}/#{year}/#{date}/#{filename}")
    File.chmod(0644, "/net/media/images/#{camera}/#{year}/#{date}/#{filename}")
  end
  print "\n"
end

# Dir.glob('/media/disk/DCIM/102_FUJI/*').each { |file| copy_images(file, 'fuji x100') } if Dir.exist?('/media/disk/DCIM/102_FUJI')
# Dir.glob('/media/SIGMA DP1/DCIM/100SIGMA/*').each { |file| copy_images(file, 'sigma dp1') } if Dir.exist?('/media/SIGMA DP1/DCIM/100SIGMA')
Dir.glob('/media/disk/DCIM/102_FUJI/*').each { |file| copy_images(file, 'photos') } if Dir.exist?('/media/disk/DCIM/102_FUJI')
Dir.glob('/media/SIGMA DP1/DCIM/100SIGMA/*').each { |file| copy_images(file, 'photos') } if Dir.exist?('/media/SIGMA DP1/DCIM/100SIGMA')

