#!/bin/sh

# X11 Dynamic Menu
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ...................................................................... Wrapper

# dmenu wrapper
# - Necessitated by a problem with bash dynamically parsing the argument list in a single dmenu call
# with a multiword prompt (even though the parsing works in a terminal window)
# - Usage: $(dmenu) -p 'multiword phrase' [parameters.. ]

# adjust font for macbook nvidia display
nvidia && font='Arial-8' || font='Arial-10'
theme=green

# dmenu prompt bar (pixel) height, for dlist or simple prompt
H=24
[[ $* ]] && menu=$(( $H * ($@ + 1) )) || menu=$H
[[ $(pidof compton) ]] && dim='-dim 0.66'

# dmenu2 vertical positioning
Y() {
  case $@ in
    left)     Y=$(( (1050 - $menu) / 2 )) ;;
    right)    Y=$(( (1600 - $menu) / 2 )) ;;
    macbook)  Y=$(( (900 - $menu) / 2 )) ;;
    laptop|*) Y=0 ;;
  esac
}

Y=0
case $(< ~/.windowmanager) in
  herbstluftwm)   height=$(xdpyinfo  | grep 'dimensions:' | grep -oE '[0-9]{1,}' | sed -n 2p)
                  if [[ $height -gt 900 ]]; then
                    focus=$(herbstclient list_monitors | grep '\[FOCUS\]' | cut -d: -f1)
                    case $focus in
                      0)  Y 'right' ;;
                      1)  Y 'left' ;;
                    esac
                  elif [[ $height -gt 600 ]]; then
                    Y 'macbook'
                  fi
                  ;;
  bspwm)          focus=$(bspc query --monitors --monitor focused)
                  case $focus in
                    DVI-0)  Y 'left' ;;
                    DVI-1)  Y 'right' ;;
                  esac
                  ;;
esac

# dmenu2 extensions
dmenu() {
  echo /usr/bin/dmenu -i $dim -y $Y -h $H -fn "$font" -nb "#333" $@
}

case $theme in
  red)        dmenu -sb "#d00" -sf "#fff" ;;
  darkred)    dmenu -sb "#b5423f" ;;
  yellow)     dmenu -sb "#ffde1e" -sf "#333" ;;
  darkyellow) dmenu -sb "#fd0" -sf "#555" ;;
  green)      dmenu -sb "#4E9258" -sf "#fff" ;;
  darkgreen)  dmenu -sb "#080" -sf "#fff" ;;
  blue)       dmenu -sb "#099" ;;
  darkblue|*) dmenu ;;
esac
