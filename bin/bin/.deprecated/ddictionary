#!/bin/sh

# X11 Dynamic Menu
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ................................................................... Dictionary

# lookup
word=$(xsel -o | $(dwrapper) -p 'Lookup Word:') || exit

# swap stderr with stdout to capture dict word not found hints
while hints=$(dict "$word" >/dev/null 2>&1 | cut -d':' -f2 | xargs -n1 | sort -u -f)
do
  [[ -z $word ]] && exit
  # a correct word hint, returns a newline character (\x0a)
  # echo "$hints" | od -A x -t x1z -v
  [[ -z $hints ]] && break
  # "No definitions found for" message sorted above, including lookup word
  echo $hints | sed "s/$word *//" | grep -q 'definitions for found No'
  if [[ $? -eq 0 ]]; then
    word=$($(dwrapper) -p "No definitions found for \"$word\":") || exit
  else
    word=$(echo -e "$hints" | dmenu -p 'Hints:') || exit
  fi
done
urxvtc -title "$word" -e sh -c "dict \"$word\" | less"
