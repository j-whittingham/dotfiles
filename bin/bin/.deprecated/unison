#!/bin/sh

echo >> /tmp/unison.log
echo "$(date '+@ %a %-I:%M %S%P') :: [$@]" >> /tmp/unison.log
echo $PATH >> /tmp/unison.log
unison=$(pidof unison)
if [[ -z $unison ]]; then
  rm -f /home/shum/.unison-$@ 2>/dev/null
  [[ $USER = shum ]] && /usr/bin/unison $@ -batch || su -c "/usr/bin/unison $@ -batch" shum
  # watcher instance triggered during sync?
  if [[ -f /home/shum/.unison-$@ ]]; then
    sleep
    /home/shum/bin/unison $@
  fi
fi
