#!/bin/sh

# X11 Dynamic Menu
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ............................................................ Ribbon calculator

# simple solver
vars=( $(echo {a..z}) )
for i in {a..z}
do
  eval $i=..
done
count=-1
ribbon='Solve'

eqn() {
  echo $eqn | sed -e 's/\([a-z]\)/$\1/g' \
                  -e 's/\([()]\)/\\\1/g' \
                  -e 's/\([<>]\)/../g' \
                  -e 's/[$]\(.\)[$]/$\1..$/g'
}

while eqn=$($(dmenu) -noinput -p "$ribbon$error")
do
  [[ $eqn ]] || break
  if ans=$(calc -pd "$(eval echo $(eqn))"); then
    if [[ $ans ]]; then
      if echo $ans | grep -v 'Error|Warning'; then
        echo -n "$ans" | xsel -i
        count=$(( $count + 1 ))
        [[ $count -gt 25 ]] && count=0
        eval ${vars[$count]}=$ans
        ribbon="$ribbon    $(eval echo ${vars[$count]}=$ans)"
        unset error
      else
        unset ans
      fi
    fi
  else
    unset ans
  fi
  [[ $ans ]] || error="    ?=$eqn"
done

if [[ $ans ]]; then
  echo -n "$ans" | xsel -i
  time=10000 notify "Ctrl-Alt-V" "$ans"
fi
