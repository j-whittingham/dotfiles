#!/bin/sh

# X11 Window Manager
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ........................................................................ bspwm

# Dynamic desktop width with conky panel (see sxhkdrx)
maximum_width=$(grep 'maximum_width' ~/.conkyrc | cut -d' ' -f2)
border_margin=$(grep 'border_outer_margin' ~/.conkyrc | cut -d' ' -f2)

# Make right tiled window flush with conky panel with no right hand window gap
function tiled() {
  D=$(bspc query --tree --monitor DVI-1 | grep 'T - \*' | awk '{ print $1; }')
  G=$(bspc config --desktop $D window_gap)
  echo "$maximum_width + $border_margin * 2 - $G + 2" | bc
}

# Adjust full screen padding to conky panel 
function monocle() {
  echo "$maximum_width + $border_margin * 2" | bc
}

# Full desktop is available when conky is hidden
case "$@" in
  monocle)  bspc config -m DVI-1 right_padding $(monocle) ;;
  tiled)    bspc config -m DVI-1 right_padding $(tiled) ;;
  *)        if xdotool search --onlyvisible --classname 'Conky'; then
              if bspc query --tree --monitor DVI-1 | grep -q ' M - \*'; then
                # echo monocle
                bspc config -m DVI-1 right_padding $(monocle)
              else
                # echo tiled
                bspc config -m DVI-1 right_padding $(tiled)
              fi
            else
              bspc config -m DVI-1 right_padding 0
            fi
            ;;
esac



