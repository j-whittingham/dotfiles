#!/bin/sh

# X11 Dynamic Menu
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ........................................................................ Music

playlist() {
  if (( $(mpc playlist | /usr/bin/wc -l) )); then
    mpc list artist | sort -n \
                    | sed -e "1i[ toggle ]\n[ next ]\n[ clear ]\n[ albums ]"
  else
    mpc list artist | sort -n \
                    | sed -e "1i[ albums ]"
  fi
}

albums() {
  [[ $artist = '[ albums ]' ]] && mpc list album \
                               || mpc list album artist "$artist"
}

# change $(dmenu) to $(dlist) for vertical list
mpc list artist 2>/dev/null || exit
while artist=$(playlist | $(dmenu) -p 'Artist') || exit
do
  case $artist in
    '[ toggle ]')   mpc toggle
                    echo ".. toggling playlist"
                    exit
                    ;;
    '[ next ]')     mpc play
                    mpc next
                    echo ".. toggling playlist"
                    # exit
                    ;;
    '[ clear ]')    mpc clear
                    echo ".. clearing playlist"
                    exit
                    ;;
  esac
  [[ $artist = '[ next ]' ]] && exec dmusic
  more=true
  while [[ $more ]]
  do
    if [[ $(albums | wc -l) -gt 1 ]]; then
      if [[ $artist = '[ albums ]' ]]; then
        album=$(albums | sort -n \
                       | $(dmenu) -p '● Album') || break
      else
        album=$(albums | sort -n \
                       | sed '1i[ all ]' \
                       | $(dmenu) -p '● Album') || break
      fi
    else
      album=$(albums | sort -n \
                     | $(dmenu) -p '● Album' -l 1) || break
      more=
    fi
    if [[ $album = '[ all ]' ]]; then
      playlist=$(albums)
      music="all songs available from $artist"
      more=
    else
      if [[ $artist = '[ albums ]' ]]; then
        playlist=$(mpc find album "$album")
      else
        playlist=$(mpc find artist "$artist" album "$album")
      fi
      music="$artist :: $album"
    fi
    while action=$(echo -e "[ play ]\n[ add ]\n[ insert ]" | $(dmenu) -p '●● Playlist') || break
    do
      case $action in
        '[ add ]')      echo -e "$playlist" | mpc add >/dev/null
                        echo ".. adding $music to the playlist"
                        ;;
        '[ insert ]')   echo -e "$playlist" | mpc insert >/dev/null
                        echo ".. inserting $music into the playlist"
                        ;;
        '[ play ]')     mpc clear >/dev/null
                        echo -e "$playlist" | mpc add >/dev/null
                        echo ".. playlist cleared. Adding $music to the playlist"
                        ;;
        *)              echo ".. invalid action: $action"
                        continue
                        ;;
      esac
      break
    done
    mpc play >/dev/null
  done
done
