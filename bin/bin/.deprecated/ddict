#!/bin/sh

# X11 Dynamic Menu
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# ................................................................... Dictionary


history=~/.ddict

# dictionary tape requires 2 words to avoid irregular first time usage
[[ -f $history ]] || echo -e "Carpe\nDiem" > $history

# lookup selection (unless it is a non-word), else present history tape
selection=$(xsel -o) && xsel -c
[[ $selection ]] && echo "$selection" | grep -q '[[^:alpha:]]' && unset selection

[[ $selection ]] && word=$selection || word=$(cat $history | $(dmenu) -p 'Lookup Word') || exit

# swap stderr with stdout to capture dict word not found hints
while hints=$(dict "$word" >/dev/null 2>&1 | cut -d':' -f2 | xargs -n1 | sort -u -f)
do
  [[ $word ]] || exit
  # a correct word hint, returns a newline character (\x0a).history
  # echo "$hints" | od -A x -t x1z -v
  [[ $hints ]] || break
  # "No definitions found for" message sorted above, including lookup word
  echo $hints | sed "s/$word *//" | grep -q 'definitions for found No'
  if [[ $? -eq 0 ]]; then
    word=$($(dmenu) -p "No definitions found for \"$word\"") || exit
  else
    word=$(echo -e "$hints" | $(dmenu) -p 'Hints') || exit
  fi
done

# spawn ddict within terminal command to select (hilight) next word
urxvtc -title "$word" -name 'max' -e sh -c "dict \"$word\" | less && ddict"

grep -qi $word $history || sed -i "1i$word" $history
