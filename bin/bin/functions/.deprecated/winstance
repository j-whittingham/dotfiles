#!/usr/bin/dash

# X11 Window Manager
# ▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

# .................................... Wait for application window instantiation

# Usage: winstance <application> [<cutoff>], in seconds

start=$(date '+%s')
[ $2 ] && cutoff=$2 || cutoff=10

delay=0.01

case $(cat $HOME/.windowmanager) in
  bspwm) while ! bspc query -T | grep $1
         do
           sleep $delay
           [ $(( $(date '+%s') - $start )) -gt $cutoff ] && exit 1
         done
         exit 0 ;;

  herbstluftwm) while :
                do
                  for i in $(herbstclient attr clients | egrep '0x|focus')
                  do
                    herbstclient compare clients.${i%.}.instance = $1 && exit 0
                  done
                  sleep $delay
                  [ $(( $(date '+%s') - $start )) -gt $cutoff ] && exit 1
                done ;;
esac

# vim: set ft=sh: #
