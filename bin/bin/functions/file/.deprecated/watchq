#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# File
# ══════════════════════════════════════════════════════════════════════════════

# ............................................................... watchman queue

# watchman
ROOT=$1
NAME=$2

CACHEDIR=${CACHEDIR:-$HOME/.cache}
SESSION=${SESSION:-$HOME/.session}
WATCH=$CACHEDIR/$NAME
WNAME=${WNAME:-$SESSION/$NAME}
VERBOSE=$WNAME:verbose
LOG=/tmp/$NAME.log

info() {
  name=$(echo $file | exclude | sed "s|$ROOT/||")
  if [ -n "$name" ] ;then
    trace "$1 ${target}${ROOT##*/} ${__YELLOW}$name" >>$LOG
    notify X "$1 ${target}${ROOT##*/}" "$name"
  fi
}

register() {
  if [ -f "$file" ] ;then
    ([ -e $VERBOSE ] || [ ! -e $WNAME ]) && info Register
    grep -qx "${file%/*}" $WATCH || echo ${file%/*} >>$WATCH
  fi
  unset file
}

for i in $@ ;do
  [ -d "$ROOT/${i%/*}" ] && { register; file="$ROOT/$i"; } || file="$file $i"
done
register

# vim: set ft=sh: #
